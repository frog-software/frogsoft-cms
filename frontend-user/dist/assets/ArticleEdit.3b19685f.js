var t=Object.defineProperty,e=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,i=(e,a,r)=>a in e?t(e,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[a]=r;import{p as l,i as s,r as o,z as n,B as d,c,b as u,w as p,a as h,q as m,d as g,o as f,u as b,e as y,t as v}from"./vendor.678eb57e.js";import{o as A}from"./style.9d8eb5aa.js";l("data-v-5d060ad0");const x={class:"body"},w=g("h1",{style:{"margin-left":"8vw","margin-top":"20px"}}," 文章创作中心 ",-1),_=g("h3",null,"文章封面 ",-1),j=["src"],$=g("h3",null,"文章名称 ",-1),C=g("h3",null,"文章简介 ",-1);s();const L={name:"ArticleEdit",beforeRouteEnter(t,e,a){"ArticleCreate"===t.name||t.params.id%1==0?a():a({name:"NotFound"})},data:()=>({article:{title:"",description:"",content:"",cover:"http://dummyimage.com/400x300"},buttonContent:"创建文章",btnArticleLoading:!1,btnCoverLoading:!1,isAuthor:!1}),computed:{id(){return"ArticleCreate"===this.$route.name?0:+this.$attrs.id}},watch:{$router(){this.getArticleDetails()}},created(){"ArticleCreate"===this.$route.name?this.isAuthor=!0:this.getArticleDetails()},methods:{createArticle(){this.btnArticleLoading=!0,h.post("/articles",((t,l)=>{for(var s in l||(l={}))a.call(l,s)&&i(t,s,l[s]);if(e)for(var s of e(l))r.call(l,s)&&i(t,s,l[s]);return t})({},this.article)).then((t=>{m.success("恭喜你，创建成功！"),this.$router.push({name:"ArticleDetails",params:{id:t.data.id.toString()}})})).catch((t=>{switch(m.destroy(),t.response.status){case 401:m.error("登录状态无效！请重新登录！");break;case 400:m.error("请完成所有内容！");break;case 500:m.error("服务器错误！请联系管理员！"),m.error(`错误内容:${t.response.data.msg}`);break;default:m.error("不应该出现这个错误啊！")}})).finally((()=>{this.btnArticleLoading=!1}))},updateArticle(){this.btnArticleLoading=!0,h.put(`/articles/${this.id}`,{article:{title:this.article.title,description:this.article.description,content:this.article.content,cover:this.article.cover}}).then((()=>{m.success("文章更新成功！"),this.$router.push({name:"ArticleDetails",params:{id:this.id.toString()}})})).catch((t=>{switch(m.destroy(),t.response.status){case 401:m.error("登录状态异常！请重新登录后再试！");break;default:m.error(t.toString())}})).finally((()=>{this.btnArticleLoading=!1}))},getArticleDetails(){this.id&&h.get(`/articles/${this.id}`).then((t=>{this.isAuthor=t.data.me.is_author,!1===this.isAuthor&&(m.error("你没有权限编辑本文！"),this.$router.push({name:"Forbidden"})),this.article=t.data.article}))}}},O=Object.assign(L,{setup:function(t){return(t,e)=>{const a=o("a-divider"),r=o("a-col"),i=o("a-input"),l=o("a-row"),s=o("a-textarea"),h=o("a-button");return n((f(),c("div",x,[w,u(a),u(l,{gutter:12,align:"middle",justify:"center",style:{"padding-top":"10px","padding-bottom":"60px"},type:"flex"},{default:p((()=>[u(r,{span:"3"},{default:p((()=>[_])),_:1}),u(r,{span:"12"},{default:p((()=>[u(i,{value:t.article.cover,"onUpdate:value":e[0]||(e[0]=e=>t.article.cover=e)},null,8,["value"]),g("img",{src:t.article.cover,alt:"文章目前的封面图片",style:{width:"100%"}},null,8,j)])),_:1})])),_:1}),u(l,{gutter:12,align:"middle",justify:"center",style:{"padding-top":"10px","padding-bottom":"60px"},type:"flex"},{default:p((()=>[u(r,{span:"3"},{default:p((()=>[$])),_:1}),u(r,{span:"12"},{default:p((()=>[u(i,{value:t.article.title,"onUpdate:value":e[1]||(e[1]=e=>t.article.title=e),placeholder:"输入文章名称"},null,8,["value"])])),_:1})])),_:1}),u(l,{gutter:12,align:"middle",justify:"center",style:{"padding-top":"10px","padding-bottom":"60px"},type:"flex"},{default:p((()=>[u(r,{span:"3"},{default:p((()=>[C])),_:1}),u(r,{span:"12"},{default:p((()=>[u(s,{value:t.article.description,"onUpdate:value":e[2]||(e[2]=e=>t.article.description=e),rows:4,placeholder:"输入文章简介"},null,8,["value"])])),_:1})])),_:1}),u(l,{align:"middle",justify:"center",type:"flex"},{default:p((()=>[u(b(A),{modelValue:t.article.content,"onUpdate:modelValue":e[3]||(e[3]=e=>t.article.content=e),toolbarsExclude:["htmlPreview","github"],editorClass:"width:100%",style:{width:"100%"}},null,8,["modelValue"]),u(h,{loading:t.btnArticleLoading,type:"primary",onClick:e[4]||(e[4]=e=>t.id?t.updateArticle():t.createArticle())},{default:p((()=>[y(v(t.id?"更新文章":"创建文章"),1)])),_:1},8,["loading"])])),_:1})],512)),[[d,t.isAuthor]])}}});O.__scopeId="data-v-5d060ad0";export{O as default};
