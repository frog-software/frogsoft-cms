var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,o=(t,a,i)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[a]=i;import{o as s}from"./style.9d8eb5aa.js";import{m as r,a as m,q as d,r as c,o as u,c as p,z as h,B as g,b as y,w as f,g as b,y as k,d as _,e as C,t as L,u as v,P as w}from"./vendor.678eb57e.js";import{s as S}from"./index.fffc2a39.js";const D={name:"CommentList",props:{parent:Number,pageSize:Number,id:String},data:()=>({btnCommentSubmitting:!1,newCommentValue:"",commentsLoading:!1}),computed:(O=((e,t)=>{for(var a in t||(t={}))n.call(t,a)&&o(e,a,t[a]);if(i)for(var a of i(t))l.call(t,a)&&o(e,a,t[a]);return e})({},r(["user","replyTo","comments"])),V={filteredComments(){const e=[];return this.comments.forEach((t=>{t.parent===this.parent&&e.push(t)})),e}},t(O,a(V))),methods:{commentSubmit(e){this.btnCommentSubmitting=!0;const t={content:this.newCommentValue,parent:this.parent};m.post(`/articles/${this.id}/comments`,t).then((async()=>{await S.commit("updateComments",this.id),this.newCommentValue="",d.success("评论发布成功")})).finally((()=>{setTimeout((()=>{this.btnCommentSubmitting=!1,S.commit("changeReplyTo",0)}),500)}))},commentDelete(e){this.commentsLoading=!0,m.delete(`/articles/${this.id}/comments`,{data:{id:e}}).then((async()=>{d.success("成功删除评论"),await S.commit("updateComments",this.id),this.commentsLoading=!1}))}}};var O,V;const j=C(" 评论 "),T=C(" 删除评论 "),x=["onClick"];D.render=function(e,t,a,i,n,l){const o=c("a-avatar"),s=c("a-textarea"),r=c("a-form-item"),m=c("a-button"),d=c("a-comment"),C=c("router-link"),L=c("comment-list",!0),v=c("a-list-item"),w=c("a-list");return u(),p("div",null,[h(y(d,null,{avatar:f((()=>[y(o,{alt:e.user.nickname,src:e.user.avatar},null,8,["alt","src"])])),content:f((()=>[y(r,null,{default:f((()=>[y(s,{modelValue:n.newCommentValue,"onUpdate:modelValue":t[0]||(t[0]=e=>n.newCommentValue=e),rows:4},null,8,["modelValue"])])),_:1}),y(r,null,{default:f((()=>[y(m,{disabled:""===n.newCommentValue,loading:n.btnCommentSubmitting,"html-type":"submit",type:"primary",onClick:t[1]||(t[1]=t=>l.commentSubmit(e.replyTo))},{default:f((()=>[j])),_:1},8,["disabled","loading"])])),_:1})])),_:1},512),[[g,e.replyTo===a.parent]]),l.filteredComments.length?(u(),b(w,{key:0,"data-source":l.filteredComments,header:`${l.filteredComments.length} ${l.filteredComments.length>1?"replies":"reply"}`,loading:{spinning:n.commentsLoading,delay:500},pagination:{pageSize:a.pageSize,hideOnSinglePage:!0},"item-layout":"horizontal"},{renderItem:f((({item:i})=>[y(v,null,{default:f((()=>[y(d,{author:i.user.username,content:i.content,datetime:i.time},{avatar:f((()=>[y(C,{to:{name:"UserDetails",params:{id:i.user.id}}},{default:f((()=>[y(o,{src:i.user.avatar},null,8,["src"])])),_:2},1032,["to"])])),actions:f((()=>[i.user.id===e.user.id?(u(),b(m,{key:0,disabled:n.btnCommentSubmitting,type:"text",onClick:e=>l.commentDelete(i.id)},{default:f((()=>[T])),_:2},1032,["disabled","onClick"])):k("",!0),_("span",{onClick:t=>e.store.commit("changeReplyTo",i.id)}," 回复评论 ",8,x),e.replyTo===i.id?(u(),p("span",{key:1,onClick:t[2]||(t[2]=t=>e.store.commit("changeReplyTo",0))}," 取消回复 ")):k("",!0)])),default:f((()=>[y(L,{id:a.id,comments:e.comments,"page-size":3,parent:i.id},null,8,["id","comments","parent"])])),_:2},1032,["author","content","datetime"])])),_:2},1024)])),_:1},8,["data-source","header","loading","pagination"])):k("",!0)])};const $=C(" 删除 "),z=C(" 编辑 "),P=["alt","src"],A=_("h3",null," 评论区 ",-1),E=C("返回首页");const N={name:"ArticleDetails",beforeRouteEnter(e,t,a){e.params.id%1==0?a():a({name:"NotFound"})},props:{id:String},data:()=>({spinning:!0,btnLikeLoading:!1,btnDeleteLoading:!1,hasDeleted:!1,article:{id:0,author:{id:0,username:"username",nickname:"nickname",email:"edialect@edialect.top",telephone:"",registration_time:"2000-01-01 00:00:00",login_time:"2000-01-01 00:00:00",birthday:"2000-01-01 00:00:00",avatar:"http://dummyimage.com/100x100",county:"",town:"",is_admin:!1},likes:0,views:0,like_users:[],publish_time:"2000-01-01 00:00:00",update_time:"2000-01-01 00:00:00",title:"title",description:"description",content:"content",cover:"http://dummyimage.com/160x90"},me:{liked:!1,is_author:!1}}),computed:{commentsLoading:()=>S.getters.commentsLoading},created(){m.get(`/articles/${this.id}`).then((async e=>{this.article=e.data.article,this.me=e.data.me,S.commit("updateComments",this.id)})).catch((()=>{d.destroy(),this.$router.replace({name:"NotFound"})})).finally((()=>{this.spinning=!1}))},methods:{btnLikeClick(){this.btnLikeLoading=!0,this.me.liked?m.delete(`/articles/${this.id}/like`).finally((()=>{this.me.liked=!1,setTimeout((()=>{this.btnLikeLoading=!1}),500)})):m.post(`/articles/${this.id}/like`).finally((()=>{this.me.liked=!0,setTimeout((()=>{this.btnLikeLoading=!1}),500)}))},deleteArticle(){this.btnDeleteLoading=!0,m.delete(`/articles/${this.id}`).finally((()=>{setTimeout((()=>{this.btnDeleteLoading=!1,this.hasDeleted=!0}),500)}))}}},R=Object.assign(N,{setup:function(e){return(t,a)=>{const i=c("a-button"),n=c("router-link"),l=c("a-card"),o=c("a-spin"),r=c("a-col"),m=c("a-avatar"),d=c("a-card-meta"),p=c("a-row"),h=c("a-result");return!1===t.hasDeleted?(u(),b(o,{key:0,delay:500,spinning:t.spinning},{default:f((()=>[y(p,{gutter:20,justify:"center",type:"flex"},{default:f((()=>[y(r,{span:"17"},{default:f((()=>[y(l,null,{title:f((()=>[_("h1",null,L(t.article.title),1)])),extra:f((()=>[t.me.is_author?(u(),b(i,{key:0,loading:t.btnDeleteLoading,type:"primary",onClick:t.deleteArticle},{default:f((()=>[$])),_:1},8,["loading","onClick"])):k("",!0),y(n,{to:{name:"ArticleEdit",params:{id:e.id}}},{default:f((()=>[t.me.is_author?(u(),b(i,{key:0,type:"primary"},{default:f((()=>[z])),_:1})):k("",!0)])),_:1},8,["to"]),y(i,{loading:t.btnLikeLoading,type:"primary",onClick:t.btnLikeClick},{default:f((()=>[C(L(t.me.liked?"取消":"")+"收藏 ",1)])),_:1},8,["loading","onClick"])])),cover:f((()=>[_("img",{alt:"这里本是文章的封面，其地址为"+t.article.cover+",但是显示不出来了",src:t.article.cover},null,8,P)])),default:f((()=>[_("p",null," 文章简介： "+L(t.article.description),1)])),_:1}),y(l,null,{default:f((()=>[y(v(s),{modelValue:t.article.content,"onUpdate:modelValue":a[0]||(a[0]=e=>t.article.content=e),previewOnly:!0},null,8,["modelValue"])])),_:1}),y(l,null,{default:f((()=>[_("h3",null," 发布时间:  "+L(t.article.publish_time),1),_("h3",null," 最近更新:  "+L(t.article.update_time),1),_("h3",null,[y(v(w)),C(" 阅读量："+L(t.article.views),1)])])),_:1}),y(l,null,{title:f((()=>[A])),default:f((()=>[y(o,{delay:500,spinning:t.commentsLoading},{default:f((()=>[y(D,{id:e.id?+e.id:1,"page-size":8,parent:0},null,8,["id"])])),_:1},8,["spinning"])])),_:1})])),_:1}),y(r,{span:"7"},{default:f((()=>[y(l,null,{default:f((()=>[y(d,{title:t.article.author.nickname},{avatar:f((()=>[y(n,{to:{name:"UserDetails",params:{id:t.article.author.id.toString()}}},{default:f((()=>[y(m,{src:t.article.author.avatar},null,8,["src"])])),_:1},8,["to"])])),_:1},8,["title"])])),_:1})])),_:1})])),_:1})])),_:1},8,["spinning"])):(u(),b(h,{key:1,class:"body",status:"success",title:"成功删除文章！"},{extra:f((()=>[y(n,{to:{name:"Home"}},{default:f((()=>[y(i,null,{default:f((()=>[E])),_:1})])),_:1})])),_:1}))}}});export{R as default};
